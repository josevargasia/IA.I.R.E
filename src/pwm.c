/* ************************************************************************** */
/**
 * @file pwm.c
 * @author Ingeniería Apropiada
 * @date 28/03/2020
 * @brief File containing PWM driver.
 */
/* ************************************************************************** */

/* ************************************************************************** */
/* ************************************************************************** */
/* Section: Included Files                                                    */
/* ************************************************************************** */
/* ************************************************************************** */

#include <proc/p32mx370f512l.h>

#include "system_definitions.h"

/* ************************************************************************** */
/* ************************************************************************** */
/* Section: File Scope or Global Data                                         */
/* ************************************************************************** */
/* ************************************************************************** */



/* ************************************************************************** */
/* ************************************************************************** */
// Section: Local Functions                                                   */
/* ************************************************************************** */
/* ************************************************************************** */




/* ************************************************************************** */
/* ************************************************************************** */
// Section: Interface Functions                                               */
/* ************************************************************************** */
/* ************************************************************************** */

void pwm_init(void){
    pwm_ID5_init();
}

void pwm_ID5_init(void){
    // Pin
    
    // Configuration
    OC3CON = 0;
    
    OC3CONbits.OCM = 0b110 ;    // PWM mode
    OC3CONbits.OCTSEL = 0;      // Timer2 is the clock source
    OC3RS = (uint32_t)(50*PR2)/100;
    OC3R = (uint32_t)(50*PR2)/100;
    
    OC5CONbits.ON = 1;          // ON PWM
}

void pwm_ID5_duty_set(uint8_t duty){
//    OC5CONbits.ON = 0;          // ON PWM
    OC5RS = (uint32_t)(duty*PR2)/100;
    OC5R = (uint32_t)(duty*PR2)/100;
//    OC5CONbits.ON = 1;          // ON PWM 
}
/* *****************************************************************************
 End of File
 */
